<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anketa čítanie svätého písma</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
    <div class="flex justify-center mb-4">
      <span class="text-4xl">📖</span>
    </div>
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Anketa čítanie svätého písma</h1>

    <div id="questionBox" class="bg-blue-50 text-blue-700 font-semibold py-3 px-4 rounded mb-6">
      Načíta sa otázka…
    </div>

    <div id="summaryBox" class="text-gray-700 font-semibold mb-6">
      Súhrn hlasovania (väčšina hlasov)
    </div>

    <button id="changeQuestionBtn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
      Zmeniť otázku
    </button>

    <div class="mt-8 border-t border-gray-300 pt-4">
      <h2 class="text-red-600 font-bold mb-2">Nebezpečná Zóna (Reštart)</h2>
      <button id="resetPollBtn" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 transition">
        VYMAZAŤ ANKETU (Reštart)
      </button>
    </div>

    <div id="status" class="text-sm text-gray-500 mt-4">Načítavam anketu a pripájam sa k databáze...</div>
  </div>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // ✅ Tvoj funkčný Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAf4s4NLuhtDInHgDnD22DHYDLt6yp10B0U",
      authDomain: "citanie-sv.firebaseapp.com",
      projectId: "citanie-sv",
      storageBucket: "citanie-sv.firebasestorage.app",
      messagingSenderId: "16378682541",
      appId: "1:16378682541:web:be64c5a5fff6535565724",
      measurementId: "G-VM2CKF7QY5"
    };

    // Inicializácia
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const questionBox = document.getElementById("questionBox");
    const status = document.getElementById("status");
    const changeQuestionBtn = document.getElementById("changeQuestionBtn");
    const resetPollBtn = document.getElementById("resetPollBtn");

    async function loadQuestion() {
      try {
        const docRef = doc(db, "artifacts", "default-poll-app");
        const snap = await getDoc(docRef);

        if (snap.exists()) {
          const data = snap.data();
          questionBox.textContent = data.question || "Otázka nebola nastavená.";
          status.textContent = "Pripojené k Firestore ✅";
        } else {
          questionBox.textContent = "Žiadna otázka v databáze.";
          status.textContent = "Databáza je prázdna.";
        }
      } catch (e) {
        console.error(e);
        questionBox.textContent = "Chyba načítania otázky.";
        status.textContent = "❌ Chyba: " + e.message;
      }
    }

    changeQuestionBtn.addEventListener("click", async () => {
      const novaOtazka = prompt("Zadaj novú otázku:");
      if (novaOtazka) {
        try {
          await updateDoc(doc(db, "artifacts", "default-poll-app"), { question: novaOtazka });
          questionBox.textContent = novaOtazka;
          status.textContent = "Otázka úspešne zmenená ✅";
        } catch (e) {
          console.error(e);
          status.textContent = "❌ Nepodarilo sa zmeniť otázku.";
        }
      }
    });

    resetPollBtn.addEventListener("click", async () => {
      if (confirm("Naozaj chceš vymazať anketu?")) {
        try {
          await setDoc(doc(db, "artifacts", "default-poll-app"), { question: "", userVotes: {} });
          questionBox.textContent = "Otázka bola vymazaná.";
          status.textContent = "Anketa reštartovaná 🔄";
        } catch (e) {
          console.error(e);
          status.textContent = "❌ Chyba pri resete.";
        }
      }
    });

    loadQuestion();
  </script>
</body>
</html>
