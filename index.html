<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Anketa ÄÃ­tanie svÃ¤tÃ©ho pÃ­sma</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
  <div class="bg-white rounded-2xl shadow-xl p-8 max-w-md w-full text-center">
    <div class="flex justify-center mb-4">
      <span class="text-4xl">ğŸ“–</span>
    </div>
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Anketa ÄÃ­tanie svÃ¤tÃ©ho pÃ­sma</h1>

    <div id="questionBox" class="bg-blue-50 text-blue-700 font-semibold py-3 px-4 rounded mb-6">
      NaÄÃ­ta sa otÃ¡zkaâ€¦
    </div>

    <div id="summaryBox" class="text-gray-700 font-semibold mb-6">
      SÃºhrn hlasovania (vÃ¤ÄÅ¡ina hlasov)
    </div>

    <button id="changeQuestionBtn" class="bg-blue-600 text-white px-6 py-2 rounded hover:bg-blue-700 transition">
      ZmeniÅ¥ otÃ¡zku
    </button>

    <div class="mt-8 border-t border-gray-300 pt-4">
      <h2 class="text-red-600 font-bold mb-2">NebezpeÄnÃ¡ ZÃ³na (ReÅ¡tart)</h2>
      <button id="resetPollBtn" class="bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700 transition">
        VYMAZAÅ¤ ANKETU (ReÅ¡tart)
      </button>
    </div>

    <div id="status" class="text-sm text-gray-500 mt-4">NaÄÃ­tavam anketu a pripÃ¡jam sa k databÃ¡ze...</div>
  </div>

  <script type="module">
    // Import Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // âœ… Tvoj funkÄnÃ½ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAf4s4NLuhtDInHgDnD22DHYDLt6yp10B0U",
      authDomain: "citanie-sv.firebaseapp.com",
      projectId: "citanie-sv",
      storageBucket: "citanie-sv.firebasestorage.app",
      messagingSenderId: "16378682541",
      appId: "1:16378682541:web:be64c5a5fff6535565724",
      measurementId: "G-VM2CKF7QY5"
    };

    // InicializÃ¡cia
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const questionBox = document.getElementById("questionBox");
    const status = document.getElementById("status");
    const changeQuestionBtn = document.getElementById("changeQuestionBtn");
    const resetPollBtn = document.getElementById("resetPollBtn");

    async function loadQuestion() {
      try {
        const docRef = doc(db, "artifacts", "default-poll-app");
        const snap = await getDoc(docRef);

        if (snap.exists()) {
          const data = snap.data();
          questionBox.textContent = data.question || "OtÃ¡zka nebola nastavenÃ¡.";
          status.textContent = "PripojenÃ© k Firestore âœ…";
        } else {
          questionBox.textContent = "Å½iadna otÃ¡zka v databÃ¡ze.";
          status.textContent = "DatabÃ¡za je prÃ¡zdna.";
        }
      } catch (e) {
        console.error(e);
        questionBox.textContent = "Chyba naÄÃ­tania otÃ¡zky.";
        status.textContent = "âŒ Chyba: " + e.message;
      }
    }

    changeQuestionBtn.addEventListener("click", async () => {
      const novaOtazka = prompt("Zadaj novÃº otÃ¡zku:");
      if (novaOtazka) {
        try {
          await updateDoc(doc(db, "artifacts", "default-poll-app"), { question: novaOtazka });
          questionBox.textContent = novaOtazka;
          status.textContent = "OtÃ¡zka ÃºspeÅ¡ne zmenenÃ¡ âœ…";
        } catch (e) {
          console.error(e);
          status.textContent = "âŒ Nepodarilo sa zmeniÅ¥ otÃ¡zku.";
        }
      }
    });

    resetPollBtn.addEventListener("click", async () => {
      if (confirm("Naozaj chceÅ¡ vymazaÅ¥ anketu?")) {
        try {
          await setDoc(doc(db, "artifacts", "default-poll-app"), { question: "", userVotes: {} });
          questionBox.textContent = "OtÃ¡zka bola vymazanÃ¡.";
          status.textContent = "Anketa reÅ¡tartovanÃ¡ ğŸ”„";
        } catch (e) {
          console.error(e);
          status.textContent = "âŒ Chyba pri resete.";
        }
      }
    });

    loadQuestion();
  </script>
</body>
</html>
